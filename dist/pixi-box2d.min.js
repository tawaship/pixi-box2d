/*!
 * pixi-box2d - v1.0.3
 * 
 * @require pixi.js v^5.3.3
 * @require Box2d.js
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */
this.PIXI=this.PIXI||{},function(t,e,o){"use strict";var i=o.Common.Math.b2Vec2,a=o.Dynamics.b2DebugDraw,r=o.Dynamics.b2World,s=(o.Dynamics.Contacts.b2Contact,o.Dynamics.b2ContactListener),n=o.Dynamics.b2BodyDef,d=o.Dynamics.b2FixtureDef,l=o.Dynamics.b2Body,y=o.Collision.Shapes.b2CircleShape,p=o.Collision.Shapes.b2PolygonShape,c=(o.Collision.Shapes.b2EdgeShape,30),f=1/c;function b(t){var e=t.GetFixtureA().GetUserData(),o=t.GetFixtureB().GetUserData();e&&e.emit&&e.emit("BeginContact",o),o&&o.emit&&o.emit("BeginContact",e)}function u(t){var e=t.GetFixtureA().GetUserData(),o=t.GetFixtureB().GetUserData();e&&e.emit&&e.emit("EndContact",o),o&&o.emit&&o.emit("EndContact",e)}function h(t){var e=t.GetFixtureA().GetUserData(),o=t.GetFixtureB().GetUserData();e&&e.emit&&e.emit("PreSolve",o),o&&o.emit&&o.emit("PreSolve",e)}function x(t){var e=t.GetFixtureA().GetUserData(),o=t.GetFixtureB().GetUserData();e&&e.emit&&e.emit("PostSolve",o),o&&o.emit&&o.emit("PostSolve",e)}var D=function(t){function e(e){var o=this;t.call(this);var a="number"==typeof e.gravityX?e.gravityX:0,n="number"==typeof e.gravityY?e.gravityY:9.8,d=!!e.allowSleep,l=new r(new i(a,n),d);this._box2dData={world:l,listener:new s,enabled:!0,speed:1,targets:{},deletes:{},displayOffsetX:e.displayOffsetX||0,displayOffsetY:e.displayOffsetY||0,displayAngle:e.displayAngle||0,perspectiveRatio:e.perspectiveRatio||1e3,isDisplayNegative:e.isDisplayNegative||!1},this.on("added",(function(){e.ticker.add(o._handleTick,o)})),this.on("removed",(function(){e.ticker.remove(o._handleTick,o)}));var y=this._box2dData.listener;e.listenBeginContact&&(y.BeginContact=b),e.listenEndContact&&(y.EndContact=u),e.listenPreSolve&&(y.PreSolve=h),e.listenPostSolve&&(y.PostSolve=x),l.SetContactListener(y),this.box2dEnabled=!0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var o={speed:{configurable:!0},box2dEnabled:{configurable:!0},world:{configurable:!0},displayOffsetX:{configurable:!0},displayOffsetY:{configurable:!0},displayAngle:{configurable:!0}};return e.prototype.addDebugDraw=function(t){var e=document.createElement("canvas"),o=e.getContext("2d");if(!o)return e;e.width=t.width,e.height=t.height,e.style.width=t.style.width,e.style.height=t.style.height,e.style.top=t.style.top||"0",e.style.left=t.style.left||"0",e.style.position="absolute",e.style.pointerEvents="none",e.style.zIndex="100";var i=new a;return i.SetSprite(o),i.SetDrawScale(c),i.SetFillAlpha(.5),i.SetLineThickness(1),i.SetFlags(a.e_shapeBit|a.e_jointBit),this.world.SetDebugDraw(i),e},e.prototype._handleTick=function(t){if(this._box2dData.enabled){var e=this._box2dData.world;e.Step(t*this._box2dData.speed/30,10,10),e.ClearForces(),e.DrawDebugData();var o=this._box2dData.targets;for(var i in this._box2dData.deletes){var a=this._box2dData.deletes[i];delete o[i],a.body&&(e.DestroyBody(a.body),a.body=null)}this._box2dData.deletes=[],this.reflect()}},e.prototype.reflect=function(){var t,e=this._box2dData.targets,o=this._box2dData.displayOffsetX,i=this._box2dData.displayOffsetY,a=this._box2dData.displayAngle;if(0===a)for(var r in e){var s=e[r];if(s.body){var n=s.body.GetPosition();s.y=n.y*c-i,s.x=n.x*c-o,s.rotation=s.body.GetAngle()}}else{var d=this._box2dData.isDisplayNegative,l=this._box2dData.perspectiveRatio*a;for(var y in e){var p=e[y];if(p.body){var f=p.body.GetPosition();p.y=f.y*c-i;var b=1+p.y*a;!d&&b<0?p.renderable=!1:(p.visible=!0,p.scale.set(b),p.x=(f.x*c-o)*b,p.y*=b/l,p.rotation=p.body.GetAngle())}}var u=this.removeChildren().sort((function(t,e){return t.y===e.y?Math.abs(t.x)-Math.abs(e.x):t.y-e.y}));(t=this).addChild.apply(t,u)}},o.speed.get=function(){return this._box2dData.speed},o.speed.set=function(t){this._box2dData.speed=t},o.box2dEnabled.get=function(){return this._box2dData.enabled},o.box2dEnabled.set=function(t){this._box2dData.enabled=t},o.world.get=function(){return this._box2dData.world},e.prototype.addBox2d=function(t){if(!t.body){for(var e=this._box2dData.world.CreateBody(t.getBodyDef()),o=t.getFixtureDefs(),a=0;a<o.length;a++)e.CreateFixture(o[a]);t.body=e,e.SetPosition(new i(t.x*f,t.y*f)),e.SetAngle(t.rotation)}return t.reflect(),this.addChild(t),this._box2dData.targets[t.box2dID]=t,delete this._box2dData.deletes[t.box2dID],t},e.prototype.removeBox2d=function(t){return this.removeChild(t),this._box2dData.deletes[t.box2dID]=t,t},o.displayOffsetX.get=function(){return this._box2dData.displayOffsetX},o.displayOffsetX.set=function(t){this._box2dData.displayOffsetX=t},o.displayOffsetY.get=function(){return this._box2dData.displayOffsetY},o.displayOffsetY.set=function(t){this._box2dData.displayOffsetY=t},o.displayAngle.get=function(){return this._box2dData.displayAngle},o.displayAngle.set=function(t){this._box2dData.displayAngle=t},Object.defineProperties(e.prototype,o),e}(e.Container);function v(t){void 0===t&&(t=!1);var e=new n;return t?e.type=l.b2_dynamicBody:l.b2_staticBody,e}var _=v(!0),g=v(!1);var m=function(t){function e(o){void 0===o&&(o={}),t.call(this);var i=function(t,e){void 0===t&&(t={});var o=new d;return o.density="number"==typeof t.density?t.density:o.density,o.friction="number"==typeof t.friction?t.friction:o.friction,o.restitution="number"==typeof t.restitution?t.restitution:o.restitution,o.filter.categoryBits="number"==typeof t.categoryBits?t.categoryBits:o.filter.categoryBits,o.filter.maskBits="number"==typeof t.maskBits?t.maskBits:o.filter.maskBits,o.isSensor=!!t.isSensor,o.userData=e,o}(o,this);this._box2dData={id:e._id++,body:null,bodyDef:o.isStatic?g:_,fixtureDefs:[i],maskBits:i.filter.maskBits}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var o={box2dID:{configurable:!0},body:{configurable:!0}};return e.prototype.BeginContact=function(t){},e.prototype.EndContact=function(t){},e.prototype.PreSolve=function(t){},e.prototype.PostSolve=function(t){},e.prototype.getBodyDef=function(){return this._box2dData.bodyDef},e.prototype.getFixtureDefs=function(){return this._box2dData.fixtureDefs},o.box2dID.get=function(){return this._box2dData.id},o.body.get=function(){return this._box2dData.body},o.body.set=function(t){this._box2dData.body=t},e.prototype.setX=function(t){this.x=t;var e=this._box2dData.body;if(e){var o=e.GetPosition();o.x=t*f,e.SetPosition(o)}},e.prototype.setY=function(t){this.y=t;var e=this._box2dData.body;if(e){var o=e.GetPosition();o.y=t*f,e.SetPosition(o)}},e.prototype.setRotation=function(t){this.rotation=t;var e=this._box2dData.body;e&&e.SetAngle(t)},e.prototype.reflect=function(){this.setX(this.x),this.setY(this.y),this.setRotation(this.rotation),this.addMask(this._box2dData.maskBits)},e.prototype.addMask=function(t){if(this._box2dData.maskBits|=t,this._box2dData.body)for(var e=this._box2dData.body.GetFixtureList();e;){var o=e.GetFilterData();o.maskBits=this._box2dData.maskBits,e.SetFilterData(o),e=e.GetNext()}},e.prototype.addAllMask=function(){if(this._box2dData.maskBits=65535,this._box2dData.body)for(var t=this._box2dData.body.GetFixtureList();t;){var e=t.GetFilterData();e.maskBits=65535,t.SetFilterData(e),t=t.GetNext()}},e.prototype.removeMask=function(t){if(this._box2dData.maskBits^=this._box2dData.maskBits&t,this._box2dData.body)for(var e=this._box2dData.body.GetFixtureList();e;){var o=e.GetFilterData();o.maskBits=this._box2dData.maskBits,e.SetFilterData(o),e=e.GetNext()}},e.prototype.removeAllMask=function(){if(this._box2dData.maskBits=0,this._box2dData.body)for(var t=this._box2dData.body.GetFixtureList();t;){var e=t.GetFilterData();e.maskBits=0,t.SetFilterData(e),t=t.GetNext()}},e.prototype.toDynamic=function(){this._box2dData.body&&this._box2dData.body.SetType(l.b2_dynamicBody)},e.prototype.toStatic=function(){this._box2dData.body&&this._box2dData.body.SetType(l.b2_staticBody)},Object.defineProperties(e.prototype,o),e}(e.Container);m._id=0,delete m.prototype.BeginContact,delete m.prototype.EndContact,delete m.prototype.PreSolve,delete m.prototype.PostSolve;var B=function(t){function o(e,o){void 0===o&&(o={}),t.call(this,o),this.getFixtureDefs()[0].shape=new y(e*f)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.from=function(t,i){void 0===i&&(i={});var a=new o(Math.max(t.width/2,t.height/2),i),r=a.addChild(new e.Container);r.addChild(t);var s=a.getLocalBounds();return r.x=-s.x-t.width/2,r.y=-s.y-t.height/2,a},o}(m),S=function(t){function o(e,o,a){void 0===a&&(a={}),t.call(this,a),e*=f,o*=f;var r=this.getFixtureDefs()[0],s=new p;s.SetAsArray([new i(0,0),new i(e,0),new i(e,o),new i(0,o)]),r.shape=s}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.from=function(t,i){void 0===i&&(i={});var a=new o(t.width,t.height,i),r=a.addChild(new e.Container);r.addChild(t);var s=a.getLocalBounds();return r.x=-s.x,r.y=-s.y,a},o}(m),w=function(t){function e(e,o){void 0===o&&(o={}),t.call(this,o);var i=this.getFixtureDefs()[0],a=new p;a.SetAsArray(e),i.shape=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(m),C=function(t){function e(e,o){void 0===o&&(o={}),t.call(this,o);var a=this.getFixtureDefs()[0],r=new p;r.SetAsEdge(new i(0,0),new i(e.x*f,e.y*f)),a.shape=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(m);Object.keys(o).forEach((function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})),t.Box2dObject=m,t.Circle=B,t.Edge=C,t.Polygon=w,t.Rectangle=S,t.WorldContainer=D}(this.PIXI.box2d=this.PIXI.box2d||{},PIXI,Box2D);//# sourceMappingURL=pixi-box2d.min.js.map
